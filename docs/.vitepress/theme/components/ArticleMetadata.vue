<script lang="ts" setup>
import { useData } from 'vitepress'
import { computed, ref, onMounted } from 'vue'
import { countWord } from '../untils/functions'

const { page } = useData()
const date = computed(
  () => new Date(page.value.lastUpdated!)
)

const wordCount = ref(0)
const imageCount = ref(0)

const wordTime = computed(() => {
    return ((wordCount.value / 275) * 60)
})

const imageTime = computed(() => {
    const n = imageCount.value
    if (imageCount.value <= 10) {
        // 等差数列求和
        return n * 13 + (n * (n - 1)) / 2
    }
    return 175 + (n - 10) * 3
})

// 阅读时间
const readTime = computed(() => {
    return Math.ceil((wordTime.value + imageTime.value) / 60)
})


function analyze() {
    document.querySelectorAll('.meta-des').forEach(v => v.remove())
    const docDomContainer = window.document.querySelector('#VPContent')
    const imgs = docDomContainer?.querySelectorAll<HTMLImageElement>(
        '.content-container .main img'
    )
    imageCount.value = imgs?.length || 0
    const words = docDomContainer?.querySelector('.content-container .main')?.textContent || ''
    wordCount.value = countWord(words)
}

onMounted(() => {
    // 初始化时执行一次
    analyze()
})
</script>


<template>
    <div class="word">
        <p>
            <svg t="1751011240374" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="13978" width="16" height="16"><path d="M960 128H833c0-53-43-96-96-96h-16c-53 0-96 43-96 96H400c0-26.5-10.7-50.5-28.1-67.9C354.5 42.7 330.5 32 304 32h-16c-53 0-96 43-96 96H64c-35.3 0-64 28.6-64 64v736c0 35.3 28.7 64 64 64h896c35.3 0 64-28.7 64-64V192c0-35.4-28.7-64-64-64z m-271 8c0-22.1 17.9-40 40-40s40 17.9 40 40v80c0 22.1-17.9 40-40 40-11 0-21-4.5-28.3-11.7C693.5 237 689 227 689 216v-80z m-433 0c0-22.1 17.9-40 40-40s40 17.9 40 40v80c0 22.1-17.9 40-40 40-11 0-21-4.5-28.3-11.7C260.5 237 256 227 256 216v-80z m704 760c0 17.7-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V448h896v448z" p-id="13979" fill="#f98328"></path><path d="M96 512h256v160H96zM96 704h256v160H96zM384 512h256v160H384zM384 704h256v160H384zM672 512h256v160H672zM672 704h256v160H672z" p-id="13980" fill="#f8ae75" data-spm-anchor-id="a313x.search_index.0.i16.2a553a81YgfA2S" class=""></path></svg>
            更新时间: {{ date.toLocaleDateString() }}&emsp; 
            <svg t="1751011085940" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11932" width="16" height="16"><path d="M367.3984 422.4l-174.6432 22.5536s-33.3568 1.3952-25.0112 32.3072l119.552 429.696s3.584 21.9776 30.208 12.0832L473.6 874.7776 367.3984 422.4z" fill="#FF7805" p-id="11933"></path><path d="M78.1696 320L268.8 273.1776l-72.064-52.672L130.1888 217.6s-63.4368 12.416-52.032 102.4z" fill="#FFBF59" p-id="11934"></path><path d="M883.1104 764.288L351.488 921.6s-52.7104-477.6064-113.7152-615.936c0 0-31.9488-77.6448-109.7728-85.44L695.1296 89.6896s92.5056-6.7456 125.7984 93.8624c0-0.0384 64.9984 185.216 62.1824 580.736z" fill="#FFECCD" p-id="11935"></path><path d="M328.96 301.3504l405.7088-108.9664c5.9904-1.6128 12.1088 2.0224 14.0416 8.32l5.888 19.1104c1.024 3.3664 0.7296 7.04-0.8576 10.1376a11.9552 11.9552 0 0 1-7.4752 6.2208l-407.2832 109.056a11.0336 11.0336 0 0 1-8.9344-1.472 12.6592 12.6592 0 0 1-5.3504-7.8592l-4.352-19.1872c-1.536-6.7968 2.304-13.6704 8.6016-15.36zM354.6112 412.7872l407.6288-117.9776a10.496 10.496 0 0 1 9.1392 1.664c2.7264 1.9584 4.6464 5.12 5.3376 8.768l3.8016 20.096c1.3952 7.296-2.4832 14.5408-8.704 16.3584l-407.0656 118.6944a10.496 10.496 0 0 1-9.024-1.5744 13.8368 13.8368 0 0 1-5.4016-8.5504l-4.3776-20.8c-1.5488-7.3856 2.3296-14.848 8.6656-16.6784z" fill="#FFD694" p-id="11936"></path><path d="M281.6 636.544a51.2 51.2 0 0 1 44.48-50.7648l177.4848-23.5136a51.2 51.2 0 0 0 33.4592-19.0208l90.2016-114.176A51.2 51.2 0 0 1 667.4048 409.6H896a51.2 51.2 0 0 1 51.2 51.2V853.4784a51.2 51.2 0 0 1-48.7296 51.1488l-563.2 27.1872A51.2 51.2 0 0 1 281.6 880.6656V636.544z" fill="#FA9600" p-id="11937"></path><path d="M788.9536 563.2H719.232a16.7552 16.7552 0 0 0-11.9552 5.8368c-3.1488 3.584-4.9024 8.3712-4.9024 13.3632s1.7536 9.7792 4.9024 13.3632 7.4368 5.6704 11.9552 5.8368h27.648l-74.7904 82.4064-10.0864 11.1232-1.7536 1.8944-22.3104 24.576-80.6272-88.768a17.3568 17.3568 0 0 0-5.632-4.1984 15.9616 15.9616 0 0 0-13.3504 0 17.3568 17.3568 0 0 0-5.6448 4.1984l-92.9536 102.3744c-3.0208 3.648-4.6336 8.448-4.5312 13.376 0.1152 4.928 1.9328 9.6256 5.1072 13.12 3.1744 3.4944 7.424 5.504 11.904 5.6192 4.48 0.128 8.832-1.664 12.16-4.992l80.6144-88.8064 80.64 88.8192c1.6 1.792 3.52 3.2128 5.632 4.1856a15.9488 15.9488 0 0 0 13.3504 0c2.112-0.9728 4.032-2.3936 5.632-4.1856l34.6624-38.1824 86.6304-95.424v30.4256a20.992 20.992 0 0 0 1.152 7.552c0.8448 2.3936 2.1248 4.5824 3.7504 6.4384 1.6256 1.8432 3.5712 3.328 5.7216 4.3264a16.064 16.064 0 0 0 13.6064 0c2.1504-0.9984 4.096-2.4832 5.7344-4.3264a19.584 19.584 0 0 0 3.7376-6.4512 20.992 20.992 0 0 0 1.152-7.5392v-76.8c0-5.0816-1.8432-9.9584-5.12-13.5552a16.6656 16.6656 0 0 0-12.3136-5.6064z" fill="#FEE4BB" p-id="11938"></path></svg>
            字数: {{ wordCount }} 字&emsp; 
            <svg t="1751011557748" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="21978" width="16" height="16"><path d="M510.476308 235.176577a48.701392 48.701392 0 0 0-48.526835 48.526834v244.379744a48.526835 48.526835 0 1 0 96.879113 0v-244.379744a48.526835 48.526835 0 0 0-48.352278-48.526834z" fill="#2e55f5" p-id="21979" data-spm-anchor-id="a313x.search_index.0.i39.2a553a81YgfA2S" class=""></path><path d="M513.094662 486.713155a48.526835 48.526835 0 0 0-34.911392 82.739999l120.967973 120.967973a48.526835 48.526835 0 1 0 68.600885-68.600885l-120.967972-120.967973a48.352278 48.352278 0 0 0-34.911392-14.139114z" fill="#2e55f5" p-id="21980" data-spm-anchor-id="a313x.search_index.0.i38.2a553a81YgfA2S" class=""></path><path d="M384.097069 622.867584a74.012151 74.012151 0 1 0 74.012151 74.01215A73.837594 73.837594 0 0 0 384.097069 622.867584z" fill="#1296db" opacity=".3" p-id="21981" data-spm-anchor-id="a313x.search_index.0.i41.2a553a81YgfA2S" class=""></path><path d="M511.872764 1023.999476a508.833537 508.833537 0 0 1-173.335061-30.198354 43.63924 43.63924 0 1 1 29.674683-82.041771 425.046196 425.046196 0 1 0-163.908985-107.003416 43.63924 43.63924 0 1 1-63.189619 60.222151 511.975562 511.975562 0 1 1 370.758982 159.02139z" fill="#2e55f5" p-id="21982" data-spm-anchor-id="a313x.search_index.0.i37.2a553a81YgfA2S" class=""></path></svg>
            阅读时长约: {{ readTime }} 分钟
        </p>
    </div>
</template>

<style>
.word {
  color: var(--vp-c-text-2);
  font-size: 15px;
}

.icon {
    display: inline-block;
    transform: translate(0px , 2px);
}
</style>
